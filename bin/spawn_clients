#!/usr/bin/env ruby
#trap("INT") {
  #children.each do |c|
  #  Process.kill("SIGKILL",c)
  #end
#  puts "Interrupted.  Killed #{children.size} children."
  #exit
#}



puts "creating #{ARGV[0]} clients"
puts "using configuration file #{ARGV[1]}" unless ARGV[1].nil?
children=[]

ARGV[0].to_i.times do |i|
  children << fork do
    #$stderr=$stdout=open("/dev/null","w")
    args = ""
    args = "--config #{ARGV[1]}" unless ARGV[1].nil?
    exec("dstream_client", args)
  end
end

Process.wait
